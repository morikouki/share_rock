<%= render 'user/users/profile' %>
<div class="row">
	<h2 class="col-xs-offset-3"><%= @event.title %>
		<span id="map-btn" class="cursor" style='font-size: 15px;'>
			<i class="fas fa-map-marker-alt icon col-xs-offset-2"></i>
			<%= @event.prefecture_code %><%= @event.city %><span style='font-size: 12px;'> <表示する> </span>
		</span>
	</h2>
	<div id="map-box" class="text-center">
		<i class="fas fa-times-circle cursor" id="map-close-btn"></i>
		<div id='map' class="<%= @event.prefecture_code + @event.city %>"></div>
	</div>

	<div class="show-container">
		<div class="event-show-image-box">
			<%= attachment_image_tag @event, :image, class: "event-show-image" %>
		</div>
		<div class="event-show-text-box">
			<div class="event-show-explanation col-xs-offset-3"><%= @event.explanation %><br></div>
		</div>
        <h2 id="index-link">投稿一覧
        	<span id="post-btn" class="btn-vertical-border cursor col-xs-offset-4" style="font-size: 15px;">投稿する</span>
        </h2>
        <div id="post-form-box">
        	<i class="fas fa-times-circle cursor" id="post-form-close-btn"></i>
			<%= form_with model:[@event, @post], url:user_event_posts_path(@event) do |f| %>
				<div class="post-image-form">
					<% @post.post_images.each do |image| %>
						<div class="post-form-box-image1 cursor">
							<%= attachment_image_tag image, :image, fallback: "Share.png", class: "img-prev1", size: "250x250" %>
							<span class="post-form-image-btn1" onClick="$('#image1').click()" style='font-size: 30px;' >
								<i class="fas fa-camera"></i>
							</span>
							<span id="delete-image-btn1" class="delete-image">削除</span>
						</div>
						<div class="post-form-box-image2 cursor">
							<%= attachment_image_tag image, :image, fallback: "Share.png", class: "img-prev2", size: "250x250" %>
							<span class="post-form-image-btn2" onClick="$('#image2').click()" style='font-size: 30px;' >
								<i class="fas fa-camera"></i>
							</span>
							<span id="delete-image-btn2" class="delete-image">削除</span>
						</div>
						<div class="post-form-box-image3 cursor">
							<%= attachment_image_tag image, :image, fallback: "Share.png", class: "img-prev3", size: "250x250" %>
							<span class="post-form-image-btn3" onClick="$('#image3').click()" style='font-size: 30px;' >
								<i class="fas fa-camera"></i>
							</span>
							<span id="delete-image-btn3" class="delete-image">削除</span>
						</div>
					<% end %>
					<%= f.fields_for :post_images do |i| %>
						<div class="image-field">
							<%= i.attachment_field :image, multiple: true, name: "post_images[image][]", id: 'image1' %>
						</div>
						<div class="image-field">
							<%= i.attachment_field :image, multiple: true, name: "post_images[image][]", id: 'image2' %>
						</div>
						<div class="image-field">
							<%= i.attachment_field :image, multiple: true, name: "post_images[image][]", id: 'image3' %>
						</div>
					<% end %>
				</div>
				<div class="post-comment-form">
					<%= f.label :post_title, 'タイトル' %>
					<%= f.text_field :post_title %><br>
					<%= f.label :post_text, 'コメント' %>
					<%= f.text_area :post_text %>
					<%= f.submit '投稿する' %>
				</div>
			<% end %>
		</div>

		<div class="user-post-contents">
			<%= render 'user/users/post_index', posts: @posts, event: @event %>
		</div>
		<%= paginate @posts, params: { anchor: 'index-link' } %>
	</div>
</div>

<script>
	/*
	mapを関数の外で定義(codeAddressでも使うため)
	geocoderを用意
	*/
	let map
	let geocoder

	function initMap(){
	  // geocoderを初期化
	  geocoder = new google.maps.Geocoder()
	  geocoder.geocode( { 'address': $('#map').attr('class')}, function(results, status) {
	    if (status == 'OK') {
	　　　　　　　　　　　　// map.setCenterで地図が移動
	      map.setCenter(results[0].geometry.location);

	　　　　　　　　　　　　// google.maps.MarkerでGoogleMap上の指定位置にマーカが立つ
	      var marker = new google.maps.Marker({
	          map: map,
	          position: results[0].geometry.location
	      });
	    } else {
	      alert('Geocode was not successful for the following reason: ' + status);
	    }
	  });

	  map = new google.maps.Map(document.getElementById('map'), {
	  center: {lat: -34.397, lng: 150.644},
	  zoom: 8
	  });
	}
	function codeAddress(){
	  // 入力を取得
	  let inputAddress = document.getElementById('address').value;

	  // geocodingしたあとmapを移動
	}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP'] %>&callback=initMap" async defer></script>